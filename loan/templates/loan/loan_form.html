{% extends 'loan/base.html' %}

{% block content %}
  <h1>Add Loan</h1>

  <form method="post" id="loan-form">
    {% csrf_token %}
    <input type="hidden" name="num_forms" value="{{ forms|length }}">
    
    <div id="loan-forms">
      {% for form in forms %}
        <div class="loan-form">
          {{ form.as_p }}
          {% if not forloop.first %}
            <button type="button" class="remove-form">Remove</button>
          {% endif %}
        </div>
      {% endfor %}
    </div>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://code.jquery.com/ui/1.13.1/jquery-ui.min.js"></script>
    <script>
      $(function() {
        $('input[type=date]').datepicker({
          dateFormat: 'yy-mm-dd',
          showButtonPanel: true
        });
      });
    </script>
    <button type="button" id="add-form">Add Loan</button>
    <button type="submit">Save</button>
  </form>

  <script>
    const addFormBtn = document.querySelector('#add-form');
    const formsContainer = document.querySelector('#loan-forms');

    function addForm() {
      const numForms = formsContainer.children.length;
      const formHtml = `
        <div class="loan-form">
          ${formsContainer.lastElementChild.innerHTML.replace(/__prefix__/g, numForms)}
          <button type="button" class="remove-form">Remove</button>
        </div>
      `;
      formsContainer.insertAdjacentHTML('beforeend', formHtml);
    }

    function removeForm(e) {
      if (e.target.classList.contains('remove-form')) {
        e.preventDefault();
        e.target.closest('.loan-form').remove();
      }
    }

    addFormBtn.addEventListener('click', addForm);
    formsContainer.addEventListener('click', removeForm);
  </script>
{% endblock %}
